<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Angr Overflow Analysis" /><meta property="og:locale" content="en" /><meta name="description" content="Hello everyone," /><meta property="og:description" content="Hello everyone," /><link rel="canonical" href="https://memorymeld.github.io/angr-full-binary/" /><meta property="og:url" content="https://memorymeld.github.io/angr-full-binary/" /><meta property="og:site_name" content="memorymeld’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-11-12T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Angr Overflow Analysis" /><meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-11-24T01:48:05+01:00","datePublished":"2023-11-12T00:00:00+01:00","description":"Hello everyone,","headline":"Angr Overflow Analysis","mainEntityOfPage":{"@type":"WebPage","@id":"https://memorymeld.github.io/angr-full-binary/"},"url":"https://memorymeld.github.io/angr-full-binary/"}</script><title>Angr Overflow Analysis | memorymeld's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="memorymeld's blog"><meta name="application-name" content="memorymeld's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.3/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> </a><h1 class="site-title"> <a href="/">memorymeld's blog</a></h1><p class="site-subtitle fst-italic mb-0">A blog focused on reverse engineering, exploit development, and red team concepts</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/memorymeld" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="" aria-label="mastodon" target="_blank" rel="noopener noreferrer me" > <i class="fab fa-mastodon"></i> </a> <a href="" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Angr Overflow Analysis</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Angr Overflow Analysis</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1699743600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Nov 12, 2023 </time> </span> <span> Updated <time data-ts="1700786885" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Nov 23, 2023 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/MemoryMeld"></a> </em> </span> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1726 words" > <em>9 min</em> read</span></div></div></header><div class="content"><p>Hello everyone,</p><p>I wanted to share my recent experience using Angr to detect overflows in binaries. I’ve dedicated several late nights to crafting an Angr script capable of identifying these overflows and now I’m eager to share my findings. My quest has been to explore alternative methods for analyzing binaries for memory corruption. From my experience, automated static analyzers have proven unreliable in detecting memory corruption.<br /> <br /> Even when armed with the source code, I strongly advocate for the utilization of coverage-guided fuzzing tools such as AFL++ or libFuzzer to unearth vulnerabilities, favoring them over static analyzers. My approach primarily involves employing AFL++ in qemu mode for testing binaries. However, complexities arise when handling binaries that rely on socket communication over networks. AFL++, primarily designed for file-based fuzzing, requires a workaround involving desock and binary patching to interact with binaries using sockets. A notable demonstration of this technique can be found in Attify’s insightful blog, showcasing the process at <a href="https://blog.attify.com/fuzzing-iot-binaries-with-afl-part-ii/">https://blog.attify.com/fuzzing-iot-binaries-with-afl-part-ii/</a>.<br /> <br /> In certain intricate scenarios, maneuvering through the complexities of patching binaries can be a daunting task. In these instances, I believe Angr becomes a valuable ally for researchers. I intend to delve into a specific recurrent case, delving into the insights gained while utilizing Angr to detect overflows. For this exploration, I’ll be referencing code from the following GitHub repository: <a href="https://github.com/shenfeng/tiny-web-server/tree/master">https://github.com/shenfeng/tiny-web-server/tree/master</a>. This code harbors a known buffer overflow, manifesting at line 255 within the url_decode function. My focus, however, won’t revolve around the discovery and exploitation of this overflow, as these aspects have been extensively covered. Instead, I aim to scrutinize prevalent solutions to discern if they effectively detect this overflow.</p><p><br /> The initial method I’ll employ is detailed in this article: <a href="https://security.humanativaspa.it/automating-binary-vulnerability-discovery-with-ghidra-and-semgrep/">https://security.humanativaspa.it/automating-binary-vulnerability-discovery-with-ghidra-and-semgrep/</a>. The approach outlined in this article involves crafting semgrep rules and analyzing Ghidra’s decompilation against those rules. However, this method is contingent on the presence of the memcpy function call in the decompilation. Notably, it’s a common optimization by compilers to eliminate certain C library calls, including memcpy. In the context of the url_decode function, the memcpy call is optimized out in both IDA and Ghidra’s decompilation. Consequently, the absence of this call causes the semgrep rules to overlook the vulnerable section of code.<br /> \</p><p><a href="/assets/posts/2023-11-12-angr-full-binary/ida_decompilation_tiny.bmp" class="popup img-link shimmer"><img src="/assets/posts/2023-11-12-angr-full-binary/ida_decompilation_tiny.bmp" alt="" loading="lazy"></a></p><p><a href="/assets/posts/2023-11-12-angr-full-binary/ghidra_decompilation_tiny.bmp" class="popup img-link shimmer"><img src="/assets/posts/2023-11-12-angr-full-binary/ghidra_decompilation_tiny.bmp" alt="" loading="lazy"></a></p><p>Another technique worth discussing involves utilizing cwe_checker (<a href="https://github.com/fkie-cad/cwe\_checker">https://github.com/fkie-cad/cwe_checker</a>) to identify the vulnerability. However, upon executing cwe_checker, it does not flag any vulnerability within the url_decode function.</p><p><a href="/assets/posts/2023-11-12-angr-full-binary/cwe_checker_tiny.bmp" class="popup img-link shimmer"><img src="/assets/posts/2023-11-12-angr-full-binary/cwe_checker_tiny.bmp" alt="" loading="lazy"></a></p><p>Now, I’ll delve into my use of Angr to uncover the overflow within the url_decode function. Despite its effectiveness, leveraging Angr for the analysis of extensive binaries has presented challenges, notably due to path explosion. Symbolic execution, a core aspect of Angr, systematically explores all potential execution paths within a program. However, in the case of large binaries characterized by numerous conditional branches, loops, and intricate control flow, the sheer volume of potential paths can multiply rapidly, leading to what’s known as path explosion. This phenomenon significantly slows down the analysis process and often results in freezing my virtual machine.<br /> <br /> I highly recommend conducting Angr analyses on a VM or host equipped with ample CPU and memory resources to support the demanding nature of this process. In light of path explosion, I’ve often found greater success by directing Angr to a specific function address, initiating the analysis from that point onward. A great demonstration of this approach, focusing on pinpointing buffer overflows, is detailed in this gitbook: <a href="https://breaking-bits.gitbook.io/breaking-bits/vulnerability-discovery/automated-exploit-development/buffer-overflows">https://breaking-bits.gitbook.io/breaking-bits/vulnerability-discovery/automated-exploit-development/buffer-overflows</a>.<br /> <br /> I embarked on the challenge of analyzing the full binary to uncover the memcpy buffer overflow. Through numerous hours dedicated to debugging, making necessary modifications, and enduring VM freezes, I ultimately achieved this task. My initial approach involved extracting all functions from the binary’s .text section, constructing a dictionary that Angr could reference during analysis. I specifically aimed to exclude any C library calls and functions attributed to the GCC toolchain. My objective was to obtain the start addresses for each instance the function was called, subsequently utilizing these addresses in Angr for overflow analysis. To accomplish this, I opted to employ radare2 for disassembling the binary due to its command-line interface and user-friendly nature. Below, I’ve included the code used for this stage.</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">r2pipe</span>
<span class="kn">import</span> <span class="n">argparse</span>

<span class="k">def</span> <span class="nf">get_function_xrefs</span><span class="p">(</span><span class="n">binary_path</span><span class="p">):</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2pipe</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">binary_path</span><span class="p">)</span>

    <span class="c1"># Analyze the binary
</span>    <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">aaa</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># Get a list of functions
</span>    <span class="n">functions</span> <span class="o">=</span> <span class="n">r2</span><span class="p">.</span><span class="nf">cmdj</span><span class="p">(</span><span class="sh">'</span><span class="s">aflj</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">function_xrefs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">excluded_functions</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">sym.deregister_tm_clones</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">sym.register_tm_clones</span><span class="sh">"</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
        <span class="n">function_name</span> <span class="o">=</span> <span class="n">function</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">function_name</span> <span class="ow">in</span> <span class="n">excluded_functions</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Check if the function is in the .text section and not an import
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">function_name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">sym.imp.</span><span class="sh">'</span><span class="p">):</span>
            <span class="c1"># Analyze cross-references to the function
</span>            <span class="n">xrefs</span> <span class="o">=</span> <span class="n">r2</span><span class="p">.</span><span class="nf">cmdj</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">axtj </span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xrefs</span><span class="p">:</span>
                <span class="c1"># Extract the starting address of the call instruction
</span>                <span class="n">call_start_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">xref</span><span class="p">[</span><span class="sh">'</span><span class="s">from</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">xref</span> <span class="ow">in</span> <span class="n">xrefs</span><span class="p">]</span>

                <span class="n">function_xrefs</span><span class="p">[</span><span class="n">function_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">call_start_addresses</span>

    <span class="k">return</span> <span class="n">function_xrefs</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">Print start addresses of calls to functions</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">binary_path</span><span class="sh">'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Path to the binary</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>

    <span class="n">function_xrefs</span> <span class="o">=</span> <span class="nf">get_function_xrefs</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">binary_path</span><span class="p">)</span>

    <span class="n">total_xrefs</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">xrefs</span><span class="p">)</span> <span class="k">for</span> <span class="n">xrefs</span> <span class="ow">in</span> <span class="n">function_xrefs</span><span class="p">.</span><span class="nf">values</span><span class="p">())</span>

    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Total Cross-references: </span><span class="si">{</span><span class="n">total_xrefs</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">function</span><span class="p">,</span> <span class="n">xrefs</span> <span class="ow">in</span> <span class="n">function_xrefs</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Function Name: </span><span class="si">{</span><span class="n">function</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">xref</span> <span class="ow">in</span> <span class="n">xrefs</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Call Start Address: </span><span class="si">{</span><span class="nf">hex</span><span class="p">(</span><span class="n">xref</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

</pre></table></code></div></div><p><a href="/assets/posts/2023-11-12-angr-full-binary/call_start_addresses.bmp" class="popup img-link shimmer"><img src="/assets/posts/2023-11-12-angr-full-binary/call_start_addresses.bmp" alt="" loading="lazy"></a></p><p>The script’s output highlights 22 cross-references, with just one pointing to url_decode. The subsequent phase involves integrating this script logic into my Angr analysis. Enclosed below is the fully implemented script designed to retrieve all call start addresses and conduct buffer overflow analysis on each. To manage the load and mitigate potential VM freezes, I constrained the concurrent processes to 8. The analysis time per process was also limited to 5 seconds, a deliberate measure to address path explosion challenges. Although extending the analysis time could enhance path exploration, in this context, a shallow path traversal sufficed to pinpoint the overflow.</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">angr</span>
<span class="kn">import</span> <span class="n">claripy</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">r2pipe</span>
<span class="kn">import</span> <span class="n">argparse</span>
<span class="kn">import</span> <span class="n">multiprocessing</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="c1"># Disable integer to string conversion limit
</span><span class="n">sys</span><span class="p">.</span><span class="nf">set_int_max_str_digits</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">check_buffer_overflow</span><span class="p">(</span><span class="n">simgr</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">simgr</span><span class="p">.</span><span class="n">unconstrained</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">path</span><span class="p">.</span><span class="nf">satisfiable</span><span class="p">(</span><span class="n">extra_constraints</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">.</span><span class="n">regs</span><span class="p">.</span><span class="n">pc</span> <span class="o">==</span> <span class="mh">0x4343434343434343</span><span class="p">]):</span>
            <span class="n">bb_addrs</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="n">history</span><span class="p">.</span><span class="n">bbl_addrs</span><span class="p">.</span><span class="n">hardcopy</span>
            <span class="n">potential_overflow_addr</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="c1"># Find the first occurrence of a basic block address that's different from the current one
</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">bb_addrs</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">bb_addrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">bb_addrs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="n">potential_overflow_addr</span> <span class="o">=</span> <span class="n">bb_addrs</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">potential_overflow_addr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">path</span><span class="p">.</span><span class="nf">add_constraints</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">regs</span><span class="p">.</span><span class="n">pc</span> <span class="o">==</span> <span class="mh">0x4343434343434343</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">path</span><span class="p">.</span><span class="nf">satisfiable</span><span class="p">():</span>
                    <span class="n">stdin_payload</span> <span class="o">=</span> <span class="n">path</span><span class="p">.</span><span class="n">solver</span><span class="p">.</span><span class="nf">eval</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">cast_to</span><span class="o">=</span><span class="nb">bytes</span><span class="p">)</span>
                    <span class="nf">save_overflow_info</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">potential_overflow_addr</span><span class="p">,</span> <span class="n">stdin_payload</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">simgr</span>

<span class="k">def</span> <span class="nf">save_overflow_info</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>

    <span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">overflow_</span><span class="si">{</span><span class="nf">hex</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s">.txt</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Address: </span><span class="si">{</span><span class="nf">hex</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Payload: </span><span class="si">{</span><span class="n">payload</span><span class="p">.</span><span class="nf">hex</span><span class="p">()</span> <span class="si">}</span><span class="se">\n</span><span class="sh">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_function_xrefs</span><span class="p">(</span><span class="n">binary_path</span><span class="p">,</span> <span class="n">excluded_functions</span><span class="p">):</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2pipe</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">binary_path</span><span class="p">)</span>

    <span class="c1"># Analyze the binary
</span>    <span class="n">r2</span><span class="p">.</span><span class="nf">cmd</span><span class="p">(</span><span class="sh">'</span><span class="s">aaa</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># Get a list of functions
</span>    <span class="n">functions</span> <span class="o">=</span> <span class="n">r2</span><span class="p">.</span><span class="nf">cmdj</span><span class="p">(</span><span class="sh">'</span><span class="s">aflj</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">function_xrefs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
        <span class="n">function_name</span> <span class="o">=</span> <span class="n">function</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span>

        <span class="c1"># Check if the function is in the .text section and not an import
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">function_name</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">'</span><span class="s">sym.imp.</span><span class="sh">'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">function_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_functions</span><span class="p">:</span>
            <span class="c1"># Analyze cross-references to the function
</span>            <span class="n">xrefs</span> <span class="o">=</span> <span class="n">r2</span><span class="p">.</span><span class="nf">cmdj</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">axtj </span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xrefs</span><span class="p">:</span>
                <span class="c1"># Extract the starting address of the call instruction
</span>                <span class="n">call_start_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">xref</span><span class="p">[</span><span class="sh">'</span><span class="s">from</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">xref</span> <span class="ow">in</span> <span class="n">xrefs</span><span class="p">]</span>

                <span class="n">call_start_addresses_hex</span> <span class="o">=</span> <span class="p">[</span><span class="nf">hex</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">call_start_addresses</span><span class="p">]</span>

                <span class="n">function_xrefs</span><span class="p">[</span><span class="n">function_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">call_start_addresses_hex</span>

    <span class="k">return</span> <span class="n">function_xrefs</span>

<span class="k">def</span> <span class="nf">analyze_function</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">call_start_address</span><span class="p">,</span> <span class="n">payload_size</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">,</span> <span class="n">result_queue</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
    <span class="n">project</span> <span class="o">=</span> <span class="n">angr</span><span class="p">.</span><span class="nc">Project</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">load_options</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">auto_load_libs</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>

    <span class="c1"># Set up the initial state with symbolic stdin
</span>    <span class="n">random_payload</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">urandom</span><span class="p">(</span><span class="n">payload_size</span><span class="p">)</span>
    <span class="n">sym</span> <span class="o">=</span> <span class="n">claripy</span><span class="p">.</span><span class="nc">BVV</span><span class="p">(</span><span class="n">random_payload</span><span class="p">)</span>
    <span class="n">initial_state</span> <span class="o">=</span> <span class="n">project</span><span class="p">.</span><span class="n">factory</span><span class="p">.</span><span class="nf">entry_state</span><span class="p">(</span><span class="n">addr</span><span class="o">=</span><span class="n">call_start_address</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">sym</span><span class="p">)</span>

    <span class="c1"># Create a new SimulationManager for analysis
</span>    <span class="n">simgr_function</span> <span class="o">=</span> <span class="n">project</span><span class="p">.</span><span class="n">factory</span><span class="p">.</span><span class="nf">simulation_manager</span><span class="p">(</span><span class="n">initial_state</span><span class="p">,</span> <span class="n">save_unconstrained</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Analyze the control flow graph of the binary
</span>    <span class="n">cfg</span> <span class="o">=</span> <span class="n">project</span><span class="p">.</span><span class="n">analyses</span><span class="p">.</span><span class="nc">CFGFast</span><span class="p">()</span>
    
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
    <span class="n">simgr_function</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="k">lambda</span> <span class="n">simgr</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;=</span> <span class="n">timeout</span> <span class="ow">or</span> <span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">simgr_function</span><span class="p">.</span><span class="n">unconstrained</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nf">any</span><span class="p">([</span><span class="n">path</span><span class="p">.</span><span class="nf">satisfiable</span><span class="p">(</span><span class="n">extra_constraints</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">.</span><span class="n">regs</span><span class="p">.</span><span class="n">pc</span> <span class="o">==</span> <span class="n">call_start_address</span><span class="p">])</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">simgr_function</span><span class="p">.</span><span class="n">unconstrained</span><span class="p">])))</span>

    <span class="c1"># Check for buffer overflow
</span>    <span class="n">simgr_function</span> <span class="o">=</span> <span class="nf">check_buffer_overflow</span><span class="p">(</span><span class="n">simgr_function</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">)</span>
    
    <span class="n">result_queue</span><span class="p">.</span><span class="nf">put</span><span class="p">((</span><span class="n">call_start_address</span><span class="p">,</span> <span class="n">simgr_function</span><span class="p">.</span><span class="n">unconstrained</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>

    <span class="c1"># Set up Angr project
</span>    <span class="n">project</span> <span class="o">=</span> <span class="n">angr</span><span class="p">.</span><span class="nc">Project</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">binary</span><span class="p">,</span> <span class="n">load_options</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">auto_load_libs</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>

    <span class="n">excluded_functions</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">sym.deregister_tm_clones</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">sym.register_tm_clones</span><span class="sh">"</span><span class="p">]</span>

    <span class="n">function_xrefs</span> <span class="o">=</span> <span class="nf">get_function_xrefs</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">binary</span><span class="p">,</span> <span class="n">excluded_functions</span><span class="p">)</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">result_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="p">.</span><span class="n">Queue</span>

    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="p">.</span><span class="nc">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># Iterate over the functions and xrefs and use the pool to parallelize the analysis
</span>    <span class="k">for</span> <span class="n">function</span><span class="p">,</span> <span class="n">call_start_addresses</span> <span class="ow">in</span> <span class="n">function_xrefs</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">call_start_addresses</span><span class="p">:</span>
            <span class="n">addr_int</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="n">pool</span><span class="p">.</span><span class="nf">apply_async</span><span class="p">(</span><span class="n">analyze_function</span><span class="p">,</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">binary</span><span class="p">,</span> <span class="n">addr_int</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">payload_size</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">result_queue</span><span class="p">,</span> <span class="n">timeout</span><span class="p">))</span>

    <span class="n">pool</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="n">pool</span><span class="p">.</span><span class="nf">join</span><span class="p">()</span>

    <span class="c1"># Collect the results
</span>    <span class="k">while</span> <span class="ow">not</span> <span class="n">result_queue</span><span class="p">.</span><span class="nf">empty</span><span class="p">():</span>
        <span class="n">addr</span><span class="p">,</span> <span class="n">unconstrained</span> <span class="o">=</span> <span class="n">result_queue</span><span class="p">.</span><span class="nf">get</span><span class="p">()</span>
        <span class="n">results</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">addr</span><span class="p">,</span> <span class="n">unconstrained</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">addr</span><span class="p">,</span> <span class="n">unconstrained</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">unconstrained</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="nc">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">Angr script</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">binary</span><span class="sh">'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Path to the binary to analyze</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--payload-size</span><span class="sh">'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Size of the payload for analysis</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">--output-folder</span><span class="sh">'</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="sh">'</span><span class="s">output</span><span class="sh">'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">'</span><span class="s">Folder to save output files</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">output_folder</span><span class="p">):</span>
        <span class="n">os</span><span class="p">.</span><span class="nf">makedirs</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">output_folder</span><span class="p">)</span>

    <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="sh">"</span><span class="s">angr</span><span class="sh">"</span><span class="p">).</span><span class="nf">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">CRITICAL</span><span class="p">)</span>

    <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

</pre></table></code></div></div><p><a href="/assets/posts/2023-11-12-angr-full-binary/angr_found_overflows.bmp" class="popup img-link shimmer"><img src="/assets/posts/2023-11-12-angr-full-binary/angr_found_overflows.bmp" alt="" loading="lazy"></a></p><p>Upon running the script, Angr successfully identified multiple potential overflows. Specifically, Angr pinpointed a potential overflow within the url_decode function, displaying the payload used to trigger it. To execute this overflow, the provided code allows for the payload to be sent as an HTTP GET request, effectively triggering the identified overflow.</p><div class="language-py highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">re</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://127.0.0.1:9999</span><span class="sh">"</span>

<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">output/overflow_0x401e4a.txt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">Payload: </span><span class="sh">"</span><span class="p">):</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="nf">len</span><span class="p">(</span><span class="sh">"</span><span class="s">Payload: </span><span class="sh">"</span><span class="p">):].</span><span class="nf">strip</span><span class="p">()</span>
            <span class="k">break</span>

<span class="c1"># Send the payload as a GET request
</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Request successful</span><span class="sh">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Request failed with status code: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

</pre></table></code></div></div><p><a href="/assets/posts/2023-11-12-angr-full-binary/sent_angr_payload.bmp" class="popup img-link shimmer"><img src="/assets/posts/2023-11-12-angr-full-binary/sent_angr_payload.bmp" alt="" loading="lazy"></a></p><p>Reflecting on the test, it’s evident that Angr showcases significant prowess in analyzing entire binaries to unveil shallow bugs. Moreover, when tasked with specific functions, Angr demonstrates exceptional capabilities. While the payload generation may not be immediately relevant, the ability to identify and isolate sections of code proves invaluable, enabling researchers to efficiently prioritize their reverse engineering efforts.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/linux/">Linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/vulnerability-research/" class="post-tag no-text-decoration" >Vulnerability Research</a> <a href="/tags/symbolic-execution/" class="post-tag no-text-decoration" >Symbolic Execution</a> <a href="/tags/reverse-engineering/" class="post-tag no-text-decoration" >Reverse Engineering</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Angr%20Overflow%20Analysis%20-%20memorymeld's%20blog&url=https%3A%2F%2Fmemorymeld.github.io%2Fangr-full-binary%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Angr%20Overflow%20Analysis%20-%20memorymeld's%20blog&u=https%3A%2F%2Fmemorymeld.github.io%2Fangr-full-binary%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmemorymeld.github.io%2Fangr-full-binary%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/angr-full-binary/">Angr Overflow Analysis</a><li class="text-truncate lh-lg"> <a href="/ghidra-scripting-xrefs/">Ghidra Scripting - XRefs and Decompilation</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/reverse-engineering/">Reverse Engineering</a> <a class="post-tag btn btn-outline-primary" href="/tags/symbolic-execution/">Symbolic Execution</a> <a class="post-tag btn btn-outline-primary" href="/tags/vulnerability-research/">Vulnerability Research</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/ghidra-scripting-xrefs/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1699916400" data-df="ll" > Nov 14, 2023 </time><h4 class="pt-0 my-2">Ghidra Scripting - XRefs and Decompilation</h4><div class="text-muted"><p> Hello everyone, I’m excited to share the recent experiments I’ve been conducting with Ghidra scripting. The capabilities of Ghidra’s decompiler and scripting tools truly stand out, surpassing what...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"><div class="btn btn-outline-primary disabled" aria-label="Older"><p>-</p></div><a href="/ghidra-scripting-xrefs/" class="btn btn-outline-primary" aria-label="Newer" ><p>Ghidra Scripting - XRefs and Decompilation</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p> © <time>2023</time> <a href="https://github.com/MemoryMeld"></a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/reverse-engineering/">Reverse Engineering</a> <a class="post-tag btn btn-outline-primary" href="/tags/symbolic-execution/">Symbolic Execution</a> <a class="post-tag btn btn-outline-primary" href="/tags/vulnerability-research/">Vulnerability Research</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
